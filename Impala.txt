--Impala

impala-shell

INVALIDATE METADATA;

USE movielens;

SELECT * FROM userdata;



////////////////////////////////////////////////////////////////////////////
Exercise 1

CREATE DATABASE movielens;

USE movielens;


CREATE TABLE usertable (userid INT, age INT, sex STRING, job STRING, zipcode STRING)  row format DELIMITED FIELDS TERMINATED BY '|' LINES TERMINATED BY '\n';

DESCRIBE usertable;

sudo hadoop fs -put /home/cloudera/Downloads/ml-100k/u.user  /user/hive/warehouse/movielens.db/usertable

invalidate metadata;

SELECT * FROM usertable WHERE job = 'engineer';

SELECT * FROM usertable WHERE sex = 'F' AND age <= 18;

SELECT COUNT(job) FROM usertable WHERE job = 'student' AND age <= 18;



////////////////////////////////////////////////////////////////////////////
Exercise 2


CREATE TABLE IF NOT EXISTS filmtable (filmid INT, 
                            title STRING, 
                            release STRING,
                            vrelease STRING,
                            imbd STRING,
                            unknown TINYINT,
                            action TINYINT,
                            adventure TINYINT,
                            animation TINYINT, 
                            children TINYINT,
                            comedy TINYINT,
                            crime TINYINT,
                            documentary TINYINT,
                            drama TINYINT,
                            fantasy TINYINT,
                            filmnoir TINYINT,
                            horror TINYINT,
                            musical TINYINT,
                            mystery TINYINT,
                            romance TINYINT,
                            scifi TINYINT,
                            thriller TINYINT,
                            war TINYINT,
                            western TINYINT) 
                            ROW FORMAT DELIMITED 
                            FIELDS TERMINATED BY '|' 
                            LINES TERMINATED BY '\n';

sudo hadoop fs -put /home/cloudera/Downloads/ml-100k/u.item  /user/hive/warehouse/movielens.db/filmtable

hadoop fs -cat /user/hive/warehouse/movielens.db/filmtable/u.item

SELECT title FROM filmtable LIMIT 10;

SELECT title FROM filmtable WHERE comedy = 1 AND scifi = 1;



////////////////////////////////////////////////////////////////////////////
Exercise 3

CREATE TABLE IF NOT EXISTS customers (custid INT,
fname STRING,
lname STRING,
email STRING,
phone MAP<STRING, STRING>,
address STRUCT<line1:STRING, line2:STRING, city:STRING, county:STRING, postcode:STRING>

ROW FORMAT DELIMITED FIELDS TERMINATED BY '|'
MAP KEYS TERMINATED BY ':';